<html>
<head>
<script src="http://code.createjs.com/easeljs-0.8.0.min.js"></script>
<script>
var oikealle = true; 
var stage;
var ukkoBitmap;
var blokinKoko = 50;
var skaalaus = blokinKoko/150;
var yVauhti = 0;
var xVauhti = 0;
var painovoima = -0.3;
var hyppypituus = 0;
var nappiPohjassa = false;
var blokkienTiedot = [];
var hyppyPalkki;


//Jollakin ohjelmointikerralla alhaalla esitetty tasonluomistapa pit‰isi toteuttaa.
var kentta2 = [
   '..........X...................',
   '..........X...................',
   '..........X...................',
   '..........X...................',
   'XXX.......X...................',
   '..XXXXX...X...................',
   '..........X...................',
   '..........X.....X.............',
   '...XXX....X...................',
   '.....XXXXXXX..................',
   '..............................',
   '..............................',
   'X........X......X.............',
   '...X.....X....................',
   '...XX....XXX..................',
];

window.onload = function() {
    //Create a stage by getting a reference to the canvas
    stage = new createjs.Stage("Pelialue");

    TestiTausta = new createjs.Shape();
    TestiTausta.graphics.beginFill("blue").drawRect(0, 0, 1350, 900);
    stage.addChild(TestiTausta);
    
    ukkoBitmap = new createjs.Bitmap("Gimp/Tekstuuriset/0003 T_P‰‰hahmoLatvaEhk‰_iso.png");
    ukkoBitmap.scaleX = skaalaus;
    ukkoBitmap.scaleY = skaalaus;
    ukkoBitmap.x = 0*blokinKoko;
    ukkoBitmap.y = 0*blokinKoko;
    stage.addChild(ukkoBitmap);
    
    //kentta1.forEach( function(blokki) {
    //BlokkiaLisaa(blokki.x,blokki.y);
	//} );
	
	var y = 0;
	kentta2.forEach(function(rivi){
		y++;
		for(x = 0;x < rivi.length;x++){
			merkki = rivi.charAt(x);
			if(merkki == 'X'){
			BlokkiaLisaa(x,y);
			}
		}
	});
	
        
    // state.update() needs to be called continuously.
    // First update might not show bitmaps if they are not yet loaded.
    setInterval( liikuta, 20 ); // 20 ms = 50 FPS

    window.onkeydown = function(event) { 
		if(xVauhti == 0 && yVauhti < 0.4){
			if(event.keyCode == 68 || event.keyCode == 65){
				if(nappiPohjassa == false){
					hyppyPalkki = new createjs.Bitmap("Gimp/Tekstuuriset/hyppy-palkki.png");
					hyppyPalkki.scaleX = 0.33;
					hyppyPalkki.scaleY = 0.33;
					hyppyPalkki.y = ukkoBitmap.y + 50;
					stage.addChild(hyppyPalkki);
				}
				nappiPohjassa = true;
			}
		}
    }
    
    window.onkeyup = function(event) {
		if(xVauhti == 0 && yVauhti < 0.4){
			if(event.keyCode == 68){ // D, ks. http://www.asciitable.com/
				aloitaHyppy(hyppypituus,+1);
				nappiPohjassa = false;
				hyppypituus = 0;
			}
			else if(event.keyCode == 65){ // A
				aloitaHyppy(hyppypituus,-1);
				nappiPohjassa = false;            
				hyppypituus = 0;
			}
        }
    }
    
    // Vastaavasti voidaan tehd‰: onkeyup
}

function aloitaHyppy(pituus,suunta){



	var xmlhttp = new XMLHttpRequest();
	var url = "http://127.0.0.1:1337/";
	xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		var vastaus = xmlhttp.responseText;
		console.log(vastaus);	
		// var myArr = JSON.parse(xmlhttp.responseText);
			
		}
	}
	xmlhttp.open("POST", url);
	xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	
	// { name: "John Rambo", time: "2pm" }
	xmlhttp.send(JSON.stringify( { Vaaka: ukkoBitmap.x, Pysty: ukkoBitmap.y } ));
	
	
    yVauhti = -pituus;
    xVauhti = pituus * suunta;
	stage.removeChild(hyppyPalkki);
}

function liikuta() {
    if ( nappiPohjassa ) {
		if(hyppypituus < 10){
			hyppypituus = hyppypituus + 0.1;
		}
		hyppyPalkki.scaleX = hyppypituus * 0.13;
		var hyppyPalkkiLeveys = 39 * hyppyPalkki.scaleX;
		hyppyPalkki.x = ukkoBitmap.x - 0.5 * hyppyPalkkiLeveys + 25.5;
	}
    var newX = ukkoBitmap.x + xVauhti;
    var newY = ukkoBitmap.y + yVauhti;
    if( KoskettaakoHahmoMitaanBlokkia( newX, newY ) ) {
        yVauhti = 0;
        xVauhti = 0;
    } else {
        ukkoBitmap.x = newX;
        ukkoBitmap.y = newY;
        yVauhti = yVauhti - painovoima;
    }
    stage.update();
}

function KoskettaakoHahmoMitaanBlokkia( ukkoX, ukkoY ) {
    result = false;
    blokkienTiedot.forEach( function(blokki) {
        if ( KoskettaakoHahmoBlokkia( ukkoX, ukkoY, blokki.x, blokki.y) ) result = true;
    } )
    return result;
}

function KoskettaakoHahmoBlokkia( ux1, uy1, bx1, by1 ) {
    var ux2 = ux1 + blokinKoko;
    var uy2 = uy1 + blokinKoko;
    var bx2 = bx1 + blokinKoko;
    var by2 = by1 + blokinKoko;
    if ( ux1 > bx2 ) return false; // Ukko on kokonaan blokin oikealla puolella
    if ( ux2 < bx1 ) return false; // Ukko on kokonaan blokin vasemmalla puolella
    if ( uy1 > by2 ) return false; // Ukko on kokonaan blokin alapuolella
    if ( uy2 < by1 ) return false; // Ukko on kokonaan blokin yl‰puolella
    return true; // Ukko koskettaa blokkia
}

function BlokkiaLisaa(x,y) {
    var bitmap = new createjs.Bitmap("Gimp/150x150/0002 150_TestihuoneenMateriaaliPng.png");
    bitmap.scaleX = skaalaus;
    bitmap.scaleY = skaalaus;
    bitmap.x = x*blokinKoko;
    bitmap.y = y*blokinKoko;
    stage.addChild(bitmap);
    blokkienTiedot.push( { x: x*blokinKoko, y: y*blokinKoko } );
    // blokkienTiedot = [ {x: x, y : y}, {x: x, y : y}, {x: x, y : y}, ... ] 
}


/*
Muistiinpanot Latvuston kehityksess‰ (Uskon, ett‰ ne voidaan pit‰‰ itse HTML-dokumentissa?)


Tarina
	Yleistettyn‰
		Alussa p‰‰henkilˆn veli kertoo veljelleen ja pelaajalle tarinaa kuinka kauan sitten heid‰n esi-is‰ns‰ Pilgut tulivat heid‰n saarelleen tuntemattomista syist‰. Kaikki oli hyvin, kunnes er‰s kauppias pudotti saaren 
		valtavan mangrovepuun mahlaa ker‰‰miens‰ puunpalasten p‰‰lle. Tuolloin palasista muodoistui ilke‰nn‰kˆinen maski, mik‰ teki sovinnon kauppiaan kanssa. Kauppias pit‰isi maskia koko ajan p‰‰ll‰ ja maski voisi 
		vastapalveluksena muuttaa kauppiaan miksi vain h‰n haluaisi. Kauppiaasta tuli kuuluisa ja h‰n myi n‰it‰ maagisia naamioita lis‰‰ saaren asukkaille. Kuitenkin asukkaat alkoivat ep‰ill‰ koko juttua, kun kului suunnattomasti 
		aikaa eik‰ kauppias siltik‰‰n kuollut. 
		Er‰‰n‰ p‰iv‰n‰ kuitenkin er‰s maskinpit‰jist‰ kuoli onnettomuudessa ja ruumiinavauksessa paljastui, ett‰ koko ruumis oli juurien vallassa eik‰ alkuper‰isest‰ saarelaisesta ollut miltei mit‰‰n j‰ljell‰. T‰m‰ sai
		kaikki saaren maskittomat asukkaat kauhun valtaan ja alkoi pitk‰ sota ja p‰‰henkilˆn veli ei koskaan saanut tiet‰‰ ‰idilt‰‰n miten sota p‰‰ttyi.
		Tarinan j‰lkeen ideana on se, ett‰ p‰‰henkilˆn veli l‰htee heid‰n ‰itins‰ haudalle, mik‰ on ensimm‰isen alueen lopussa. P‰‰henkilˆ hakee heid‰n talosta lahjoja haudalle samalla opettaen pelaajalle perusmekaniikat.
		Kun h‰n on saanut tavarat hankittua h‰n ei kuitenkaan p‰‰se ulos talon p‰‰ovesta. H‰n menee katon kautta jolloin h‰n n‰kee, ett‰ ovea pid‰ttelee joukko maskeja. N‰in alkaa tutoriaalitason maskitaistelu ja t‰st‰ 
		peli jatkuukin ihan tavallisesti ottaen.
		Pomotaisteluiden j‰lkeen p‰‰henkilˆ ja h‰nen veljens‰ puhuvat eri aiheista sill‰ p‰‰henkilˆn veli on maskin vallassa ja t‰m‰ maski sattuu olemaan se ensimm‰inen, mink‰ kauppias lˆysi.
		Kun p‰‰henkilˆ on viimeisen pomotaistelun ja lis‰pomojen j‰lkeen suorittanut suurpomotaistelun h‰nelle valkeaa, ett‰ vanhassa sodassa maskit voittivat, mutta kaikki maskit eiv‰t olleet loisia, mitk‰ loivat juuria
		kantajansa sis‰‰n. Jotkut halusivat olla symbioosissa ja p‰‰henkilˆ on h‰mmentynyt(?) t‰st‰.
	Moninpeli(Kyll‰, ette lukeneet v‰‰rin)
		Moninpeliss‰ parasiittimaskit kantajineen (vihreit‰) ovat maskettomia asukkaita (liiloja) vastaan ja iskujoukot (keltaisia) toiselta puolelta planeettaa ovat n‰it‰ kahta vastaan. Iskujoukot ovat tulleet paikalle
		sill‰ toisen pallonpuoliskon suurkaupungin presidentti on salaa p‰‰tt‰nyt, ett‰ turvatakseen planeetan rauhan mangrovesaaren asukkaiden maskeineen on tuhouduttava.
			Kouludemo
				Planeetan toisen puolen veteraani on tullut perheens‰ kanssa risteilyll‰ l‰helle pelin p‰‰saarta. H‰n vaimonsa ja kahden lapsensa kanssa l‰hev‰t ˆkyjahdilla turistilaivalta tiet‰m‰tt‰‰n saarta p‰in ja pian he 
				katuvat p‰‰tˆst‰‰n sill‰ laivan keulasta hyˆkk‰‰ outo maskihumanoidi ja takaa-
				p‰in taas hullu Pilgu. Veteraani sulkee vaimonsa lapsineen ruumavarastoon ja alkaa puolustamaan ovea kahdelta hyˆkk‰‰jlt‰. 
				Edell‰ mainittu tarina selitet‰‰n kaikille kolmelle pelaajalle, mutta maskihahmolle esitet‰‰n, ett‰ h‰nen t‰ytyy tuoda perheenj‰senet saarelle, jotta n‰m‰ voitaisiin "k‰‰nnytt‰‰". Hullu-Pilgu taas ainoastaan 
				tulee sekaisin ajatuksin hyˆk‰ten haluten miehistˆ‰ ˆkyjahdille p‰‰st‰kseen pois
				saarelta mahdollisimman pian.
Visuaalisuus
	Moninpeli
		Kouludemo
			Aseet
				Lemonade-revolveri koostuu keltaisesta k‰densijasta, hopeisesta makasiiniosasta, keltaisesta piipusta ja j‰lleen kerran hopeisesta piipunp‰‰st‰.
Pelimekaniikalliset aiheet
	RoopenKommentit
		Max 3 pelaajaa yht‰ aikaa kent‰ll‰ moninpeliss‰, kaikki ohjaa reaaliaikaisesti omaa ukkoaan ja taistelee
		toisiaan vastaan. Serveri, jolle kaikki koneet l‰hett‰v‰t oman pelaajan liikkeen ja 
		saavat tiedon muiden pelaajien liikkeist‰. Koska ukkojen lentorata hyppyjen aikana on
		deterministinen (ennustettava), riitt‰nee ett‰ serverille l‰hetet‰‰n tieto hypyn
		alkupaikasta ja suunnasta ja vauhdista ja kaikki koneet toisistaan riippumatta laskevat 
		lentoradat (samoin ammuttujen ammusten kohdalla)	
		
		Voi myˆs olla 2 selainta samalla koneella, jolloin.
		
		K‰ytet‰‰n AJAX-tekniikkaa: "Asynchronous JAvascript and XML"
			https://en.wikipedia.org/wiki/Ajax_(programming)
			AJAX:ssa v‰litet‰‰n JSON-viestej‰: https://en.wikipedia.org/wiki/JSON
			
		Ehk‰ k‰ytet‰‰n NODE-JS -tekniikkaa? Javascripti‰ sek‰ serverill‰ ett‰ clientill‰?
			https://en.wikipedia.org/wiki/Node.js
			(toinen mahdollisuus on k‰ytt‰‰ Ruby tai C# kieli‰)
	Kent‰t
		-
	Moninpeli
		Kouludemo
			Hahmot
				Veteraani
					Ase (Lemonade [Revolveri])
						| Ampuu nopealla tahdilla ammuksia joiden vahinko 15%. Ammukset menev‰t vihollisten ja esteiden l‰pi 20 ruutua sekunnissa.

						| Mit‰ enemm‰n ammus on penetroinnut objekteja, sit‰ v‰hemm‰n se tekee vahinkoa.
					Toissijainen toiminto (Bio Storm)
						| Veteraanin aktivoidessa t‰m‰n kyvyn h‰n saa viiden sekunnin ajan vain puolet tulevasta vahingosta ja h‰nen varasto-ovenavausprogressia ei voi jatkaa.
						
						| Kyvyn vaikutuksen loppuessa se t‰ytyy uudelleenladata menem‰ll‰ turvahuoneeseen tai odottamalla 25 sekuntia.
					Objektiivi
						Kent‰n keskell‰ alhaalla on varasto-ovi, mink‰ takana Veteraanin perhe majailee. Viholliset yritt‰v‰t p‰‰at‰ t‰m‰n oven luokse avatakseen sen. Veteraanin t‰ytyy viiden minuutin ajan est‰‰ t‰t‰ ja jos avaa-
						misprogressi on kesken ajan loppuessa ei taistelu lopu vaan vasta silloin, kun aika on lopussa ja avaamisprogressi on 0%. Kun Veteraani pysyy yksin varasto-oven edess‰ tehty avaamisprogressi katoaa
						samalla nopeudella mill‰ sit‰ ansaitaakin.
					Statit
						Liikkuu normaalinopeudella. | Liikkuvuusbonuksena kyky hyp‰t‰ ilmassa, mutta vain 50% tavallisesta hyppypituudesta. | Saadun vahingon jakajana 1.
				Hullu Pilgu
					Ase (Ancient Champion [Repaleiset nyrkkeilyhanskat])
						| Ollessaan ilmassa Pilgu voi ottaa vihollisen W-n‰pp‰imell‰ k‰siins‰ ja sitten h‰n voi heitt‰‰ t‰m‰n m‰‰r‰ten suunnan W-n‰pp‰imell‰. Kun vihollinen osuu sein‰‰n h‰n saa 10% vahinkoa, mutta h‰n kimpoaa 
						yhden kerran jolloin osuttuaan kaksi kertaa sein‰‰n, h‰n on menett‰nyt 20% el‰m‰pisteit‰. Jos heitetty vihollinen osuu toiseen viholliseen he molemmat saavat 20% edest‰ vahinkoa ja heitetty vihollinen
						lopettaa heitettyn‰ olemisen.
						
						| Kun vihollinen on Pilgun k‰dess‰, h‰n voi p‰‰st‰ pois painamalla nelj‰ kertaa ASDW-n‰pp‰imi‰ jossain tietyss‰ j‰rjestyksess‰.
					Toissijainen toiminto (Gliding)
						| Ilmassa ollessaan AD-n‰pp‰imi‰ k‰ytt‰m‰ll‰ Pilgu voi joko syˆksy‰ eteenp‰in tai k‰‰nty‰ toisinp‰in. H‰n voi syˆksyess‰‰n myˆs tˆni‰ vihollisia.
						
						| Syˆksyess‰‰n Pilgu ottaa jakaa tulevan vahingon 0.9 tehden saadusta vahingosta suuremman.
					Objektiivi
						Pilgu tulee ˆkyjahdin takaosasta ja h‰nen t‰ytyy p‰‰st‰ laivan ruuman varasto-oven luokse. Siell‰ h‰nen t‰ytyy seist‰ oven edess‰ yksin jolloin ovenavausprogressimittari t‰yttyy. Kest‰‰ kolmekymment‰
						sekuntia avata ovi ja objektiivi suoritetaan, jos ovenavaus on suoritettu ja olet ainoa henkilˆ oven edess‰.
					Statit
						Lataa hyppymittarinsa 25% nopeammin. | Likkuvuusbonuksena edell‰ mainittu hyppymittarinopeusboosti. | Saadun vahingon jakajana (kun ei syˆksym‰ss‰) 1.
				Maskihumanoidi
					Ase (Olive [Kranaatti])
						| W-n‰pp‰imell‰ Humanoidi ottaa esiin kranaatin poistaen t‰m‰n sokan jonka j‰lkeen W-n‰pp‰imell‰ h‰n voi hypyn kaltaisesti m‰‰r‰t‰ suunnan mihin kranaatti menee. R‰j‰ht‰ess‰‰n luo valtavan vahingoittavan
						alueen, miss‰ 20% edest‰ vahinkoa otetaan.
						
						| Kranaatteja heitet‰‰n hitaalla tahdilla.
					Toissijainen toiminto (Materialized Aura)
						| Humanoidi laittaa maahan maskipatsaan, mink‰ silm‰t toimivat kamerana, mink‰ l‰pi humanoidi voi n‰hd‰ kaukaisiakin asioita, mink‰ suu toimiii automaattiturrettina, jos vihollinen sattuu sen silmien
						n‰kˆkentt‰‰n ja mik‰ aiheuttaa pienell‰ alueella vihollisten tulevan vahingon jaolle 0.2 nousun.
						
						| Humanoidi voi laittaa maahan maksimissaan kolme patsasta, mutta mit‰ enmm‰n patsaita on, sit‰ v‰hemm‰n niill‰ on kykyj‰. Kahdella patsaalla on vain kamerakyky ja vahingonnosto vihollisiin-kyky, kun
						taas kolmellaon vain kamerakyky. Patasaita ei voi laittaa varasto-oven eteen ja kun kolmen patsaan ollessa kent‰ll‰ nelj‰s laitetaan t‰m‰ nelj‰s tuhoaa kolme alkuper‰ist‰. Humanoidi uudelleenlataa
						toiminnon kymmenen sekunnin viiveell‰.
					Obhektiivi
						Humanoidi tulee ˆkyjahdin keulasta ja h‰nell‰ on sama objektiivi, kuin Pilgulla, mutta humanoidi avaa varasto-ovea 10% hitaammin, kuin Pilgu.
		Aseideat
			Pistoolikaarijousi nimelt‰‰n ...
				| Aina kun aseen klippi on t‰ynn‰ se ampuu kolme eri suuntiin menev‰‰ nuolta, mitk‰ tekev‰t sit‰ enemm‰n vahinkoa mit‰ suurempi m‰‰r‰ nuolista osuu viholliseen.
				
				| Lataa hitaasti nuolia ja tekee v‰h‰n vahinkoa pienen nuolim‰‰r‰n osuessa vihollisiin.
			-
Alkuper‰inen dokumentti
|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
	Peimekaniikat
	Pelin sataprosenttinen l‰p‰isy
		Kun pelaaja on tehnyt kaikki p‰ivitykset, saanut kaikki bonusaseet ja voittanut viidennen lis‰pomon h‰n voi taistella suurpomoa vastaan. N‰in h‰n saa tiet‰‰ 
		viel‰ jotain mielenkiintoista tarinaa. H‰n voi myˆs taistella kaikkia mnipomoja, pomoja, lis‰pomoja ja viimeist‰ pomoa vastaan uudestaan.
	Pelin kahdeksan maailmaa
		Mangrovepuun latvusto (Lazy Lions)>Mangrovepuun lehvistˆ (Ancient Acorns)>Mangrovepuun lehvistˆ‰ kannatteleva oksisto (Seriosly Sacred)>Mangovepuun rungonsi-
		s‰inen mahlaa tuottava sienikammio (Tired Tree)>Mangrovepuun sis‰ll‰ oleva mehil‰ispes‰ (Emperor's Economy)>Linnoitus mangrovepuun sis‰ll‰ (Ammo Army)>Mangrovepuun maanp‰‰lliset juuret (Massive Mangrove)>
		Mangrovepuuta ymp‰rˆiv‰ hiekkaranta (Sick Sands)
	Peliobjektit
	Krediitit
		Jokaisessa kahdeksassa maailmassa sata.
		Viisikymment‰ terveysp‰ivitykseen ja loput voi k‰ytt‰‰ kyky- ja asep‰ivityksiin. 
	Bonusaseet
		Jokaisessa kahdeksassa maailmassa yksi.
		Kyseisi‰ aseita voi k‰ytt‰‰ moninpeliss‰.
	Kristalliavaimet
		K‰ytet‰‰n lis‰pomojen taisteluihin p‰‰syyn.
		Ensimm‰iseen lis‰pomoon tarvitaan kymmenen avainta, joista yhdeks‰n on pelimaailmassa ja kymmenes saadaan viimeiselt‰ pomolta.
		Toiseen lis‰pomoon tarvitaan kaksikymment‰ avainta, joista 19 on pelimaailmassa ja kahdeskymmenes saadaan ensmm‰iselt‰ lis‰pomolta.
		Kolmanteen lis‰pomoon tarvitaan kolmekymment‰ avainta, joista 29 on pelimaailmassa ja kolmaskymmenes saadaan toiselta lis‰pomolta.
		Nelj‰nteen lis‰pomoon tarvitaan nelj‰kymment‰ avainta, joista 39 on pelimaailmassa ja nelj‰skymmenes saadaan kolmannelta lis‰pomolta.
		Viidenteen lis‰pomoon tarvitaan viisikymment‰ avainta, joista 49 on pelimaailmassa ja viideskymmenes saadaan nelj‰nnelt‰ lis‰pomolta.
	V‰limuistiot
	Is‰n mˆkill‰ on er‰‰nlanen piirretty hahmo, jonka nimi on Pilkku. P‰‰hahmo ja Pilgut (Get it?) n‰ytt‰v‰t t‰lt‰ hahmolta.
_____________________________________________________________________________________________________________________________________________________________________________________________________________________________________
*/

    
 </script>
</head>
<body>
<canvas id="Pelialue" width="1350" height="900">
</canvas>
</body>
</html>
