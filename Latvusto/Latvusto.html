<html>
<head>
<script src="http://code.createjs.com/easeljs-0.8.0.min.js"></script>
<script>
var oikealle = true; 
var stage;
var ukkoBitmap;
var blokinKoko = 50;
var skaalaus = blokinKoko/150;
var yVauhti = 0;
var xVauhti = 0;
var painovoima = -0.3;
var hyppypituus = 0;
var nappiPohjassa = false;
var blokkienTiedot = [];
var hyppyPalkki;


var kentta2 = [
//Jollakin ohjelmointikerralla alhaalla esitetty tasonluomistapa pit‰isi toteuttaa.
   '............X.................',
   '............X.................',
   '............XXXX..............',
   '....o...X.....................',
   '........X.....................',
   '....XXXXXXXXXXXXXXX....====...',
   '..............................',
   '..............................'
];



var kentta1 = [ 
// Alkualusta
{x: 0, y:2}, {x: 1, y:2}, {x: 2, y:2}, {x: 2, y:3}, {x: 3, y:3}, {x: 4, y:3}, {x: 5, y:3}, {x: 6, y:3}, 
//OikeaSein‰m‰
{x: 10, y:2}, {x: 10, y:3}, {x: 10, y:4}, {x: 10, y:5}, {x: 10, y:6}, {x: 10, y:7}, {x: 10, y:1}, 
{x: 10, y:0}, {x: 9, y:7}, {x: 8, y:7}, {x: 7, y:7}, {x: 6, y:7}, {x: 5, y:7}, {x: 5, y:6}, {x: 4, y:6},
{x: 3, y:6}, {x: 11, y:7}, {x: 10, y:-1}, {x: 10, y:-2}, 
//Yksitt‰isblokit
{x: 0, y:10},
//Alatasanne
{x: 3, y:11}, {x: 3, y:12}, {x: 4, y:12},
//Ilmaeste
{x: 9, y:12}, {x: 9, y:11}, {x: 9, y:10}, {x: 10, y:12}, {x: 11, y:12},
//Kaakko
{x: 16, y:10}, {x: 16, y:5},
]
;
 
window.onload = function() {
    //Create a stage by getting a reference to the canvas
    stage = new createjs.Stage("Pelialue");

    TestiTausta = new createjs.Shape();
    TestiTausta.graphics.beginFill("blue").drawRect(0, 0, 1350, 900);
    stage.addChild(TestiTausta);
    
    ukkoBitmap = new createjs.Bitmap("Gimp/Tekstuuriset/0003 T_P‰‰hahmoLatvaEhk‰_iso.png");
    ukkoBitmap.scaleX = skaalaus;
    ukkoBitmap.scaleY = skaalaus;
    ukkoBitmap.x = 0*blokinKoko;
    ukkoBitmap.y = 0*blokinKoko;
    stage.addChild(ukkoBitmap);
    
    kentta1.forEach( function(blokki) {
    BlokkiaLisaa(blokki.x,blokki.y);
	} );
        
    // state.update() needs to be called continuously.
    // First update might not show bitmaps if they are not yet loaded.
    setInterval( liikuta, 20 ); // 20 ms = 50 FPS

    window.onkeydown = function(event) { 
		if(xVauhti == 0 && yVauhti < 0.4){
			if(event.keyCode == 68 || event.keyCode == 65){
				if(nappiPohjassa == false){
					hyppyPalkki = new createjs.Bitmap("Gimp/Tekstuuriset/hyppy-palkki.png");
					hyppyPalkki.scaleX = 0.33;
					hyppyPalkki.scaleY = 0.33;
					hyppyPalkki.y = ukkoBitmap.y + 50;
					stage.addChild(hyppyPalkki);
				}
				nappiPohjassa = true;
			}
		}
    }
    
    window.onkeyup = function(event) {
		if(xVauhti == 0 && yVauhti < 0.4){
			if(event.keyCode == 68){ // D, ks. http://www.asciitable.com/
				aloitaHyppy(hyppypituus,+1);
				nappiPohjassa = false;
				hyppypituus = 0;
			}
			else if(event.keyCode == 65){ // A
				aloitaHyppy(hyppypituus,-1);
				nappiPohjassa = false;            
				hyppypituus = 0;
			}
        }
    }
    
    // Vastaavasti voidaan tehd‰: onkeyup
}

function aloitaHyppy(pituus,suunta){
    console.log(suunta);
    yVauhti = -pituus;
    xVauhti = pituus * suunta;
	stage.removeChild(hyppyPalkki);
}

function liikuta() {
    if ( nappiPohjassa ) {
		if(hyppypituus < 10){
			hyppypituus = hyppypituus + 0.1;
		}
		hyppyPalkki.scaleX = hyppypituus * 0.14;
		var hyppyPalkkiLeveys = 39.0 * hyppyPalkki.scaleX;
		hyppyPalkki.x = ukkoBitmap.x - 0.5 * hyppyPalkkiLeveys + 25.5;
	}
    var newX = ukkoBitmap.x + xVauhti;
    var newY = ukkoBitmap.y + yVauhti;
    if( KoskettaakoHahmoMitaanBlokkia( newX, newY ) ) {
        yVauhti = 0;
        xVauhti = 0;
    } else {
        ukkoBitmap.x = newX;
        ukkoBitmap.y = newY;
        yVauhti = yVauhti - painovoima;
    }
    stage.update();
}

function KoskettaakoHahmoMitaanBlokkia( ukkoX, ukkoY ) {
    result = false;
    blokkienTiedot.forEach( function(blokki) {
        if ( KoskettaakoHahmoBlokkia( ukkoX, ukkoY, blokki.x, blokki.y) ) result = true;
    } )
    return result;
}

function KoskettaakoHahmoBlokkia( ux1, uy1, bx1, by1 ) {
    var ux2 = ux1 + blokinKoko;
    var uy2 = uy1 + blokinKoko;
    var bx2 = bx1 + blokinKoko;
    var by2 = by1 + blokinKoko;
    if ( ux1 > bx2 ) return false; // Ukko on kokonaan blokin oikealla puolella
    if ( ux2 < bx1 ) return false; // Ukko on kokonaan blokin vasemmalla puolella
    if ( uy1 > by2 ) return false; // Ukko on kokonaan blokin alapuolella
    if ( uy2 < by1 ) return false; // Ukko on kokonaan blokin yl‰puolella
    return true; // Ukko koskettaa blokkia
}

function BlokkiaLisaa(x,y) {
    var bitmap = new createjs.Bitmap("Gimp/150x150/0002 150_TestihuoneenMateriaaliPng.png");
    bitmap.scaleX = skaalaus;
    bitmap.scaleY = skaalaus;
    bitmap.x = x*blokinKoko;
    bitmap.y = y*blokinKoko;
    stage.addChild(bitmap);
    blokkienTiedot.push( { x: x*blokinKoko, y: y*blokinKoko } );
    // blokkienTiedot = [ {x: x, y : y}, {x: x, y : y}, {x: x, y : y}, ... ] 
}


/*
Muistiinpanot Latvuston kehityksess‰ (Uskon, ett‰ ne voidaan pit‰‰ itse HTML-dokumentissa?)

Tarina
	Yleistettyn‰
		Alussa p‰‰henkilˆn veli kertoo veljelleen ja pelaajalle tarinaa kuinka kauan sitten heid‰n esi-is‰ns‰ tulivat heid‰n saarelleen tuntemattomista syist‰. Kaikki oli hyvin, kunnes er‰s kauppias pudotti saaren valtavan
		mangrovepuun mahlaa ker‰‰miens‰ puunpalasten p‰‰lle. Tuolloin palasista muodoistui ilke‰nn‰kˆinen maski, mik‰ teki sovinnon kauppiaan kanssa. Kauppias pit‰isi maskia koko ajan p‰‰ll‰ ja maski voisi vastapalveluksena
		muuttaa kauppiaan miksi vain h‰n haluaisi.
		Kauppiaasta tuli kuuluisa ja h‰n myi n‰it‰ maagisia naamioita lis‰‰ saaren asukkaille. Kuitenkin asukkaat alkoivat ep‰ill‰ koko juttua, kun kului suunnattomasti aikaa eik‰ kauppias siltik‰‰n kuollut. 
		Er‰‰n‰ p‰iv‰n‰ kuitenkin er‰s maskinpit‰jist‰ kuoli onnettomuudessa ja ruumiinavauksessa paljastui, ett‰ koko ruumis oli juurien vallassa eik‰ alkuper‰isest‰ saarelaisesta ollut miltei mit‰‰n j‰ljell‰. T‰m‰ sai
		kaikki saaren maskittomat asukkaat kauhun valtaan ja alkoi pitk‰ sota ja p‰‰henkilˆn veli ei koskaan saanut tiet‰‰ ‰idilt‰‰n miten sota p‰‰ttyi.
		Tarinan j‰lkeen ideana on se, ett‰ p‰‰henkilˆn veli l‰htee heid‰n ‰itins‰ haudalle, mik‰ on ensimm‰isen alueen lopussa. P‰‰henkilˆ hakee heid‰n talosta lahjoja haudalle samalla opettaen pelaajalle perusmekaniikat.
		Kun h‰n on saanut tavarat hankittua h‰n ei kuitenkaan p‰‰se ulos talon p‰‰ovesta. H‰n menee katon kautta jolloin h‰n n‰kee, ett‰ ovea pid‰ttelee joukko maskeja. N‰in alkaa tutoriaalitason maskitaistelu ja t‰st‰ 
		peli jatkuukin ihan tavallisesti ottaen.
		Pomotaisteluiden j‰lkeen p‰‰henkilˆ ja h‰nen veljens‰ puhuvat eri aiheista sill‰ p‰‰henkilˆn veli on maskin vallassa ja t‰m‰ maski sattuu olemaan se ensimm‰inen, mink‰ kauppias lˆysi.
		Kun p‰‰henkilˆ on viimeisen pomotaistelun ja lis‰pomojen j‰lkeen suorittanut suurpomotaistelun h‰nelle valkeaa, ett‰ vanhassa sodassa maskit voittivat, mutta kaikki maskit eiv‰t olleet loisia, mitk‰ loivat juuria
		kantajansa sis‰‰n. Jotkut halusivat olla symbioosissa ja p‰‰henkilˆ on h‰mmentynyt(?) t‰st‰.
	Moninpeli(Kyll‰, ette lukeneet v‰‰rin)
		Moninpeliss‰ parasiittimaskit kantajineen (vihreit‰) ovat maskettomia asukkaita (liiloja) vastaan ja iskujoukot (oransseja) toiselta puolelta planeettaa ovat n‰it‰ kahta vastaan. Iskujoukot ovat tulleet paikalle
		sill‰ toisen pallonpuoliskon suurkaupungin presidentti on salaa p‰‰tt‰nyt, ett‰ turvatakseen planeetan rauhan mangrovesaaren asukkaiden maskeineen on tuhouduttava.
Visuaalisuus
	-
Pelimekaniikalliset aiheet
	Kent‰t
		Testitaso #1 (Oikeaa versiota muokattu)
			E
				Tyhj‰ kohta
			H
				Hahmon syntymiskohta
			P
				Blokki mik‰ yksinkertaisesti blokkaa
			HEEEEEEEEE
			EEEEEEEEEE
			PPPEEEEEEP
			EEPPPPPPPP
			EEEEEEEEEP
			EEEEEEEEEP
			EEEPPEEEEP
			PEEEPPPPPP
			EEPEEEEEEE
			EEPPEEEEEE
Alkuper‰inen dokumentti
|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
	Peimekaniikat
	Pelin sataprosenttinen l‰p‰isy
		Kun pelaaja on tehnyt kaikki p‰ivitykset, saanut kaikki bonusaseet ja voittanut viidennen lis‰pomon h‰n voi taistella suurpomoa vastaan. N‰in h‰n saa tiet‰‰ 
		viel‰ jotain mielenkiintoista tarinaa. H‰n voi myˆs taistella kaikkia mnipomoja, pomoja, lis‰pomoja ja viimeist‰ pomoa vastaan uudestaan.
	Pelin kahdeksan maailmaa
		Mangrovepuun latvusto (Lazy Lions)>Mangrovepuun lehvistˆ (Ancient Acorns)>Mangrovepuun lehvistˆ‰ kannatteleva oksisto (Seriosly Sacred)>Mangovepuun rungonsi-
		s‰inen mahlaa tuottava sienikammio (Tired Tree)>Mangrovepuun sis‰ll‰ oleva mehil‰ispes‰ (Emperor's Economy)>Linnoitus mangrovepuun sis‰ll‰ (Ammo Army)>Mangrovepuun maanp‰‰lliset juuret (Massive Mangrove)>
		Mangrovepuuta ymp‰rˆiv‰ hiekkaranta (Sick Sands)
	Peliobjektit
	Krediitit
		Jokaisessa kahdeksassa maailmassa sata.
		Viisikymment‰ terveysp‰ivitykseen ja loput voi k‰ytt‰‰ kyky- ja asep‰ivityksiin. 
	Bonusaseet
		Jokaisessa kahdeksassa maailmassa yksi.
		Kyseisi‰ aseita voi k‰ytt‰‰ moninpeliss‰.
	Kristalliavaimet
		K‰ytet‰‰n lis‰pomojen taisteluihin p‰‰syyn.
		Ensimm‰iseen lis‰pomoon tarvitaan kymmenen avainta, joista yhdeks‰n on pelimaailmassa ja kymmenes saadaan viimeiselt‰ pomolta.
		Toiseen lis‰pomoon tarvitaan kaksikymment‰ avainta, joista 19 on pelimaailmassa ja kahdeskymmenes saadaan ensmm‰iselt‰ lis‰pomolta.
		Kolmanteen lis‰pomoon tarvitaan kolmekymment‰ avainta, joista 29 on pelimaailmassa ja kolmaskymmenes saadaan toiselta lis‰pomolta.
		Nelj‰nteen lis‰pomoon tarvitaan nelj‰kymment‰ avainta, joista 39 on pelimaailmassa ja nelj‰skymmenes saadaan kolmannelta lis‰pomolta.
		Viidenteen lis‰pomoon tarvitaan viisikymment‰ avainta, joista 49 on pelimaailmassa ja viideskymmenes saadaan nelj‰nnelt‰ lis‰pomolta.
	V‰limuistiot
	Is‰n mˆkill‰ on er‰‰nlanen piirretty hahmo, jonka nimi on Pilkku. P‰‰hahmo ja Pilgut (Get it?) n‰ytt‰v‰t t‰lt‰ hahmolta.
_____________________________________________________________________________________________________________________________________________________________________________________________________________________________________
*/

    
 </script>
</head>
<body>
<canvas id="Pelialue" width="1350" height="900">
</canvas>
</body>
</html>
