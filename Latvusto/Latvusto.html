<html>
<head>
<script src="http://code.createjs.com/easeljs-0.8.0.min.js"></script>
<script>
var oikealle = true; 
var stage;
var ukkoBitmap;
var blokinKoko = 50;
var skaalaus = blokinKoko/150;
var yVauhti = 0;
var xVauhti = 0;
var painovoima = -0.3;
var hyppypituus = 0;
var nappiPohjassa = false;
var blokkienTiedot = [];


var kentta2 = [
   '............X.................',
   '............X.................',
   '............XXXX..............',
   '....o...X.....................',
   '........X.....................',
   '....XXXXXXXXXXXXXXX....====...',
   '..............................',
   '..............................'
];



var kentta1 = [ {x: 1, y:5}, {x: 2, y:5}, {x: 3, y:5}, {x: 4, y:5}, {x: 5, y:5}, {x: 6, y:5}, {x: 6, y:4},
{x: 6, y:3}, {x: 7, y:5}, {x: 8, y:5}, {x: 9, y:0}, {x: 9, y:1}, {x: 9, y:2}, {x: 9, y:5}, {x: 10, y:2},
{x: 11, y:2}, {x: 10, y:5}, {x: 11, y:5}, {x: 12, y:5}, {x: 13, y:5}, {x: 14, y:5}, {x: 18, y:3},
{x: 19, y:3}, {x: 20, y:3}, {x: 21, y:4}, {x: 21, y:5}, {x: 21, y:6}, {x: 21, y:7}, {x: 22, y:5},
{x: 23, y:5}, {x: 24, y:5}, {x: 22, y:7}, {x: 23, y:7}, {x: 24, y:7}, {x: 25, y:7}, {x: 26, y:7},
{x: 27, y:7}, {x: 28, y:7},];
 
window.onload = function() {
    //Create a stage by getting a reference to the canvas
    stage = new createjs.Stage("Pelialue");

    TestiTausta = new createjs.Shape();
    TestiTausta.graphics.beginFill("blue").drawRect(0, 0, 1350, 900);
    stage.addChild(TestiTausta);
    
    ukkoBitmap = new createjs.Bitmap("Gimp/Tekstuuriset/0003 T_PäähahmoLatvaEhkä_iso.png");
    ukkoBitmap.scaleX = skaalaus;
    ukkoBitmap.scaleY = skaalaus;
    ukkoBitmap.x = 2*blokinKoko;
    ukkoBitmap.y = 0*blokinKoko;
    stage.addChild(ukkoBitmap);

	
    
    kentta1.forEach( function(blokki) {
    BlokkiaLisaa(blokki.x,blokki.y);
	} );
        
    // state.update() needs to be called continuously.
    // First update might not show bitmaps if they are not yet loaded.
    setInterval( liikuta, 20 ); // 20 ms = 50 FPS

    window.onkeydown = function(event) { 
        if(event.keyCode == 68 || event.keyCode == 65){
            nappiPohjassa = true;
        }
    }
    
    window.onkeyup = function(event) {
        if(event.keyCode == 68){ // D, ks. http://www.asciitable.com/
            aloitaHyppy(hyppypituus,+1);
            nappiPohjassa = false;
            hyppypituus = 0;
        }
        else if(event.keyCode == 65){ // A
            aloitaHyppy(hyppypituus,-1);
            nappiPohjassa = false;            
            hyppypituus = 0;
        }
    }
    
    // Vastaavasti voidaan tehdä: onkeyup
}

function aloitaHyppy(pituus,suunta){
    console.log(suunta);
    yVauhti = -pituus;
    xVauhti = pituus * suunta;
}

function liikuta() {
    if ( nappiPohjassa ) hyppypituus = hyppypituus + 0.1;
    var newX = ukkoBitmap.x + xVauhti;
    var newY = ukkoBitmap.y + yVauhti;
    if( KoskettaakoHahmoMitaanBlokkia( newX, newY ) ) {
        yVauhti = 0;
        xVauhti = 0;
    } else {
        ukkoBitmap.x = newX;
        ukkoBitmap.y = newY;
        yVauhti = yVauhti - painovoima;
    }
    stage.update();
}

function KoskettaakoHahmoMitaanBlokkia( ukkoX, ukkoY ) {
    result = false;
    blokkienTiedot.forEach( function(blokki) {
        if ( KoskettaakoHahmoBlokkia( ukkoX, ukkoY, blokki.x, blokki.y) ) result = true;
    } )
    return result;
}

function KoskettaakoHahmoBlokkia( ux1, uy1, bx1, by1 ) {
    var ux2 = ux1 + blokinKoko;
    var uy2 = uy1 + blokinKoko;
    var bx2 = bx1 + blokinKoko;
    var by2 = by1 + blokinKoko;
    if ( ux1 > bx2 ) return false; // Ukko on kokonaan blokin oikealla puolella
    if ( ux2 < bx1 ) return false; // Ukko on kokonaan blokin vasemmalla puolella
    if ( uy1 > by2 ) return false; // Ukko on kokonaan blokin alapuolella
    if ( uy2 < by1 ) return false; // Ukko on kokonaan blokin yläpuolella
    return true; // Ukko koskettaa blokkia
}

function BlokkiaLisaa(x,y) {
    var bitmap = new createjs.Bitmap("Gimp/150x150/0002 150_TestihuoneenMateriaaliPng.png");
    bitmap.scaleX = skaalaus;
    bitmap.scaleY = skaalaus;
    bitmap.x = x*blokinKoko;
    bitmap.y = y*blokinKoko;
    stage.addChild(bitmap);
    blokkienTiedot.push( { x: x*blokinKoko, y: y*blokinKoko } );
    // blokkienTiedot = [ {x: x, y : y}, {x: x, y : y}, {x: x, y : y}, ... ] 
}

/*
Muistiinpanot Latvuston kehityksessä (Uskon, että ne voidaan pitää itse HTML-dokumentissa?)

Tarina

-

Visuaalisuus

-

Pelimekaniikalliset aiheet

-

_____________________________________________________________________________________________________________________________________________________________________________________________________________________________________
*/

    
 </script>
</head>
<body>
<canvas id="Pelialue" width="1350" height="900">
</canvas>
</body>
</html>
